# 如何撤回提交

要撤回已经提交的 Git 提交记录，你可以选择不同的方式，具体取决于提交是否已经被推送到远程仓库，以及你希望撤回的方式（完全删除提交、保留更改但重新提交、或者撤回单个文件的提交等）。

以下是几种常用的撤回提交的方式：

## **撤回本地提交（未推送到远程仓库）**

如果你还没有将提交推送到远程仓库，可以使用以下方法撤回提交。

### 使用 `git reset`（彻底删除提交）

```bash
git reset --soft HEAD^
```

- `HEAD^` 指代上一个提交（也就是你想撤回的提交）。
- `--soft` 选项会保留修改的内容，但撤回提交。此时你的文件和修改会回到暂存区，允许你重新提交。

你还可以使用 `--hard` 来完全删除提交和修改（不保留修改），但**请注意这会丢失你的修改**：

```bash
git reset --hard HEAD^
```

- 这会生成一个新的提交，撤销指定提交所做的更改，而不会修改提交历史。

## **撤回已经推送到远程仓库的提交**

如果你已经将提交推送到远程仓库，你需要谨慎操作，因为这些提交可能已经被其他人拉取。

### 使用 `git revert`（最安全的方法）

`git revert` 是最安全的方法，因为它会生成一个新的提交，撤销之前的提交，而不会直接修改历史记录：

```bash
git revert <commit_hash>
```

- `commit_hash` 是你想撤回的提交的哈希值。

此方法适用于你已经推送的提交，不会影响其他人。

### 使用 `git reset`（已推送但你想修改历史）

如果你已经推送了提交，但你想撤销这些提交并修改历史，可以使用 `git reset` 配合 `git push --force`：

1. **撤回提交**：

   ```bash
   git reset --soft HEAD^
   ```

2. **强制推送到远程仓库**：

   ```bash
   git push --force
   ```

**警告：**

- 使用 `--force` 会**重写远程仓库的历史记录**，并可能影响其他人已经拉取的提交，所以只有在确认其他开发者不会受影响的情况下使用这个方法。

## **仅撤回单个文件的提交**

如果你只想撤回某个特定文件的更改，而不是整个提交，可以使用以下方法：

### 使用 `git restore`

```bash
git restore --staged <file_path>
```

- 这会将指定文件从暂存区撤回。

### 使用 `git reset` 撤回文件

```bash
git reset HEAD <file_path>
```

- 这会将文件的更改从提交中撤回，但保留修改在工作区。

## 总结

- **未推送的提交**：使用 `git reset` 可以轻松撤回提交并重新提交。
- **已推送的提交**：使用 `git revert` 是最安全的方式，它会生成一个新的撤销提交，而不会修改历史记录。
- 使用 `git reset` 和 `git push --force` 也可以撤回已推送的提交，但请谨慎操作以避免影响他人。
